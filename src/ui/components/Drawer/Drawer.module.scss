@use "@/ui/tokens" as tokens;

// Overlay - backdrop
.overlay {
    position: fixed;
    inset: 0;
    z-index: 100;
    background: rgb(0 0 0 / 70%);

    // Halftone overlay for punk aesthetic
    @include tokens.pattern-halftone-lg;

    opacity: 0;
    pointer-events: none;
    transition: opacity 200ms ease;

    &[data-state="open"] {
        opacity: 1;
        pointer-events: auto;
    }
}

// Content - drawer panel (base styles)
.content {
    position: fixed;
    background: var(--color-bg-surface);

    @include tokens.border-standard;
    @include tokens.shadow-lg;

    z-index: 101;
    display: flex;
    flex-direction: column;
    outline: none;
    overflow: clip;
    pointer-events: none;
    opacity: 0;
    transition: opacity 160ms ease;

    --drawer-inline-size: 22rem; // cap for horizontal drawers (overridable)
    --drawer-block-size: 24rem; // cap for vertical drawers (overridable)

    @include tokens.gradient-surface-vertical;

    // Texture overlay
    isolation: isolate;

    @include tokens.texture-overlay(0.15);

    &:focus-visible {
        outline: none;
    }

    &[data-phase="opening"],
    &[data-phase="open"] {
        pointer-events: auto;
        opacity: 1;
    }

    &[data-phase="closing"],
    &[data-phase="switching-close"] {
        opacity: 1;
    }
}

// Position: bottom (default sheet from bottom)
.bottom {
    bottom: 0;
    left: 0;
    right: 0;
    border-radius: 1.6rem 1.6rem 0 0;
    border-bottom: none;
    max-height: 0; // Start at 0 for opening animation

    --drawer-block-size: 100vh;

    // Only transition max-height for top/bottom
    transition: max-height 300ms ease;

    &[data-fast-close="true"] {
        transition: max-height 150ms ease;
    }

    // Extend background beyond screen during animation (full-screen mode only)
    padding-bottom: 10vh;
    margin-bottom: -10vh;

    // Centered on desktop OR when position is absolute (portal mode)
    @media (width >= 640px) {
        left: 50%;
        right: auto;
        max-width: 32rem;
        width: 100%;
        border-radius: 2rem 2rem 0 0;
        transform: translateX(-50%);
    }

    // Always center when in portal mode (position absolute)
    &[style*="position: absolute"] {
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%);
        padding-bottom: 0; // Remove extended padding
        margin-bottom: 0;
    }

    &[data-phase="opening"],
    &[data-phase="open"] {
        max-height: var(--drawer-block-size);
    }

    &[data-phase="closing"],
    &[data-phase="switching-close"],
    &[data-phase="closed"] {
        max-height: 0 !important;
    }
}

// Position: top (sheet from top)
.top {
    top: 0;
    left: 0;
    right: 0;
    border-radius: 0 0 1.6rem 1.6rem;
    border-top: none;
    max-height: 0; // Start at 0 for opening animation

    --drawer-block-size: 350px;

    // Only transition max-height for top/bottom
    transition: max-height 300ms ease;

    &[data-fast-close="true"] {
        transition: max-height 150ms ease;
    }

    // Extend background beyond screen during animation (full-screen mode only)
    padding-top: 10vh;
    margin-top: -10vh;

    // Centered on desktop
    @media (width >= 640px) {
        left: 50%;
        right: auto;
        max-width: 32rem;
        width: 100%;
        border-radius: 0 0 2rem 2rem;
        transform: translateX(-50%);
    }

    // Always center when in portal mode (position absolute)
    &[style*="position: absolute"] {
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%);
        padding-top: 0; // Remove extended padding
        margin-top: 0;
    }

    .handle {
        margin: 0.5rem auto 0.75rem;
    }

    &[data-phase="opening"],
    &[data-phase="open"] {
        max-height: var(--drawer-block-size);
    }

    &[data-phase="closing"],
    &[data-phase="switching-close"],
    &[data-phase="closed"] {
        max-height: 0 !important;
    }
}

@keyframes slideOutBottom {
    from {
        transform: translate3d(0, 0, 0);
    }

    to {
        transform: translate3d(0, 100%, 0);
    }
}

@keyframes slideOutTop {
    from {
        transform: translate3d(0, 0, 0);
    }

    to {
        transform: translate3d(0, -100%, 0);
    }
}

@keyframes slideOutLeft {
    from {
        transform: translate3d(0, 0, 0);
    }

    to {
        transform: translate3d(-100%, 0, 0);
    }
}

@keyframes slideOutRight {
    from {
        transform: translate3d(0, 0, 0);
    }

    to {
        transform: translate3d(100%, 0, 0);
    }
}

@keyframes scaleOut {
    from {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }

    to {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
}

// Position: left (side sheet from left)
.left {
    top: 0;
    bottom: 0;
    left: 0;
    max-width: 0; // Default closed state
    width: min(var(--drawer-inline-size), 100%);
    border-radius: 0 1.6rem 1.6rem 0;
    border-left: none;

    --drawer-inline-size: 350px;

    // Extend background beyond screen during animation (full-screen mode only)
    padding-left: 10vw;
    margin-left: -10vw;

    @media (width >= 640px) {
        border-radius: 0 2rem 2rem 0;
    }

    // Remove extended padding in portal mode
    &[style*="position: absolute"] {
        padding-left: 0;
        margin-left: 0;
    }

    // Default state when closed
    &[data-phase="closed"] {
        max-width: 0 !important;
    }

    // Animate from 0 to full size when opening
    &[data-phase="opening"] {
        @starting-style {
            max-width: 0;
        }

        max-width: var(--drawer-inline-size);
        transition: max-width 300ms ease;
    }

    &[data-phase="open"] {
        max-width: var(--drawer-inline-size);
    }

    &[data-phase="closing"],
    &[data-phase="switching-close"] {
        max-width: 0 !important;
        transition: max-width 300ms ease;

        &[data-fast-close="true"] {
            transition: max-width 150ms ease;
        }
    }
}

// Position: right (side sheet from right)
.right {
    top: 0;
    bottom: 0;
    right: 0;
    max-width: 0; // Default closed state
    width: min(var(--drawer-inline-size), 100%);
    border-radius: 1.6rem 0 0 1.6rem;
    border-right: none;

    --drawer-inline-size: 350px;

    // Extend background beyond screen during animation (full-screen mode only)
    padding-right: 10vw;
    margin-right: -10vw;

    @media (width >= 640px) {
        border-radius: 2rem 0 0 2rem;
    }

    // Remove extended padding in portal mode
    &[style*="position: absolute"] {
        padding-right: 0;
        margin-right: 0;
    }

    // Default state when closed
    &[data-phase="closed"] {
        max-width: 0 !important;
    }

    // Animate from 0 to full size when opening
    &[data-phase="opening"] {
        @starting-style {
            max-width: 0;
        }

        max-width: var(--drawer-inline-size);
        transition: max-width 300ms ease;
    }

    &[data-phase="open"] {
        max-width: var(--drawer-inline-size);
    }

    &[data-phase="closing"],
    &[data-phase="switching-close"] {
        max-width: 0 !important;
        transition: max-width 300ms ease;

        &[data-fast-close="true"] {
            transition: max-width 150ms ease;
        }
    }
}

@keyframes growWidth {
    to {
        max-width: 100vw;
    }
}

@keyframes growHeight {
    to {
        max-height: 100vh;
    }
}

// Position: center (dialog/modal)
.center {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 90vw;
    max-height: 85vh;
    width: 100%;
    overflow-y: auto;

    @include tokens.radius-quirky-lg;

    animation: scaleIn 300ms var(--spring-bezier);

    @media (width >= 640px) {
        max-width: 32rem;
    }
}

// Handle - drag indicator
.handle {
    width: 3rem;
    height: 0.35rem;
    margin: 0.75rem auto 0.5rem;
    background: var(--color-ink);
    border-radius: 2rem;
    opacity: 0.3;
    animation: handlePulse 1.5s ease-in-out;
}

// Header - top section
.header {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    padding: var(--spacing-lg) var(--spacing-lg) var(--spacing-md);

    // Center text for top/bottom sheets
    .bottom &,
    .top & {
        text-align: center;
    }

    // Left-align for side sheets and center dialog
    .left &,
    .right &,
    .center & {
        text-align: left;
    }
}

// Footer - bottom section
.footer {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-xl) var(--spacing-lg);
    margin-top: auto;

    // Optional border separator
    border-top: 3px solid var(--color-ink);
    border-top-left-radius: var(--radius-sm);
    border-top-right-radius: var(--radius-sm);

    // Adjust bottom padding based on last button type (all drawer positions)
    // If last child is a ghost button, use smaller padding
    &:has(> :last-child[data-variant="ghost"]),
    &:has(> :last-child > [data-variant="ghost"]) {
        padding-bottom: var(--spacing-sm);
    }

    // If only one button and it's ghost, use medium padding
    &:has(> :only-child[data-variant="ghost"]),
    &:has(> :only-child > [data-variant="ghost"]) {
        padding-bottom: var(--spacing-md);
    }
}

// Content wrapper adjustments to prevent overflow from extended backgrounds
.bottom > *:not(.handle),
.top > *:not(.handle),
.left > *:not(.handle),
.right > *:not(.handle) {
    // Ensure content doesn't extend into the padding area
    max-width: 100%;
}

// Title - main heading
.title {
    @include tokens.text-shadow-bold;

    font-family: var(--font-family);
    font-size: var(--font-size-lg);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    line-height: 1.2;
    color: var(--color-text);
    margin: 0;
}

// Description - subtitle
.description {
    font-family: var(--font-family);
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text);
    opacity: 0.7;
    line-height: 1.4;
}

@media (prefers-reduced-motion: reduce) {
    .overlay,
    .content,
    .bottom,
    .top,
    .left,
    .right,
    .center {
        transition: none !important;
        animation: none !important;
    }

    .handle {
        animation: none;
    }
}
